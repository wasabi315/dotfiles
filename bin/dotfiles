#!/bin/bash

# utilities -------------------------------------------------------------------

tbold=$(tput bold)
tclose=$(tput sgr0)
tred=$(tput setaf 1)
tgreen=$(tput setaf 2)
tyellow=$(tput setaf 3)
tblue=$(tput setaf 4)
tpurple=$(tput setaf 5)
tcyan=$(tput setaf 6)
tgray=$(tput setaf 7)


# dotfiles --------------------------------------------------------------------

if [ -z "${DOTPATH:-}" ]; then
    DOTPATH="${HOME}/.dotfiles"; export DOTPATH
fi

help() {

    local name=`basename $0`
    cat <<EOF
Usage:
  $name <command>

This dotfiles is for my personal Ubuntu 18.04 minimal environment.

Commands:
  ${tbold}deploy${tclose}:  back up your configs and symlink dotfiles to your home directory.
           your configs backed up will locate in ${DOTPATH}/backup.

  ${tbold}init${tclose}:    install software packages.
           information for the package list: ${tbold}See https://github.com/wasabi315/dotfiles${tclose}

  ${tbold}install${tclose}: symlink dotfiles to your home directory and install software packages.

  ${tbold}update${tclose}:  update dotfiles.

  ${tbold}clean${tclose}:   remove dotfiles and restore to your original settings.

  ${tbold}help${tclose}:    print help (this message).


For more information see: ${tbold}https://github.com/wasabi315/dotfiles${tclose}
               Copyright: ${tbold}(c) 2018 wasabi315${tclose}
                Lincence: ${tbold}MIT${tclose}

EOF

}


deploy() {

    e_header "Deploying dotfiles..."
    bash ${DOTPATH}/scripts/deploy.sh
    e_done

}


init() {

    e_header "Install software packages..."
    bash ${DOTPATH}/scripts/init.sh
    e_done

}


install() {

    deploy &&
    init

}


update() {

    e_header "Updating dotfiles..."
    git pull origin master
    e_done

}


clean() {

    e_warning "WARNING: This will remove current dotfiles!!"
    e_warning "Continue? (y/n)"
    read -r REPLY
    if [ "$REPLY" == Y ] || [ "$REPLY" = y ]; then
        e_header "Cleaning dotfiles..."
        bash ${DOTPATH}/scripts/clean.sh
    else
        echo "abort."
        exit 1
    fi


}


command=$1

if [ $# -ne 1 ]; then
    usage
    exit 1
fi

case $command in
    deploy)
        deploy
        ;;
    init)
        init
        ;;
    install)
        install
        ;;
    update)
        update
        ;;
    clean)
        clean
        ;;
    *)
        help
        ;;
esac

exit 0

# vim : filetype=sh
