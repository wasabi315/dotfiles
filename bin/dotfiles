#!/bin/bash -eu

# utilities -------------------------------------------------------------------

tbold="$(tput bold)"
tclose="$(tput sgr0)"
tred="$(tput setaf 1)"
tgreen="$(tput setaf 2)"
tyellow="$(tput setaf 3)"
tblue="$(tput setaf 4)"
tpurple="$(tput setaf 5)"
tcyan="$(tput setaf 6)"
tgray="$(tput setaf 7)"

e_header() {
    printf "\n${tgray}$1${tclose}\n"
}

e_done() {
    printf "\n${tgreen}Done${tclose}"
}

# dotfiles --------------------------------------------------------------------

if [ -z "${DOTPATH:-}" ]; then
    DOTPATH="${HOME}/.dotfiles"; export DOTPATH
fi

source ${DOTPATH}/bin/deploy.sh
source ${DOTPATH}/bin/init.sh

usage() {

    local name=`basename $0`
    cat <<USAGE
Usage:
  $name <command>

This dotfiles is for my personal Ubuntu 18.04 minimal environment.

Commands:
  ${tbold}deploy${tclose}:  back up your configs and symlink dotfiles to your home directory.
           your configs backed up will locate in ${DOTPATH}/backup.

  ${tbold}init${tclose}:    install software packages.
           information for the package list: ${tbold}See https://github.com/wasabi315/dotfiles${tclose}

  ${tbold}install${tclose}: symlink dotfiles to your home directory and install software packages.

  ${tbold}update${tclose}:  update dotfiles.

  ${tbold}clean${tclose}:   remove dotfiles and restore to your original settings.

  ${tbold}usage${tclose}:    print help (this message).


For more information see: ${tbold}https://github.com/wasabi315/dotfiles${tclose}
               Copyright: ${tbold}(c) 2018 wasabi315${tclose}
                Lincence: ${tbold}MIT${tclose}

USAGE

}


deploy() {

    e_header "Deploying dotfiles..."
    deploy_dotfiles
    e_done

}


init() {

    e_header "Install software packages..."
    init_dotfiles
    e_done

}


install() {

    deploy &&
    init

}


update() {

    e_header "Updating dotfiles..."
    git pull origin master
    e_done

}


clean() {

    e_warning "WARNING: This will remove current dotfiles!!"
    e_warning "Continue? (y/n)"
    read -r REPLY
    if [ "$REPLY" == Y ] || [ "$REPLY" = y ]; then
        e_header "Cleaning dotfiles..."
        bash ${DOTPATH}/scripts/clean.sh
    else
        echo "abort."
        exit 1
    fi


}


command=$1

if [ $# -ne 1 ]; then
    usage
    exit 1
fi

case $command in
    deploy)
        deploy
        ;;
    init)
        init
        ;;
    install)
        install
        ;;
    update)
        update
        ;;
    clean)
        clean
        ;;
    *)
        usage
        ;;
esac

exit 0

# vim : filetype=sh
