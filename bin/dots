#!/bin/bash -eu

DOTPATH=${DOTPATH:-${HOME}/.dotfiles}; export DOTPATH
BACKUPPATH=${BACKUPPATH:-${HOME}/.dotfiles.back}; export BACKUPPATH

source "${DOTPATH}/lib/utils.sh"


help() {

  local name=`basename $0`

  cat <<HELP
Usage:
  $name <COMMANDS>

This dotfiles is for wasabi315's personal environment.

Commands:
  ${BOLD}deploy${CLEAR}:  back up your configs and symlink dotfiles to your home directory.

  ${BOLD}init${CLEAR}:    install missing software packages.
           information for the package list: ${BOLD} See https://github.com/wasabi315/dotfiles${CLEAR}

  ${BOLD}install${CLEAR}: symlink dotfiles to your home directory and install software packages.

  ${BOLD}update${CLEAR}:  update dotfiles.

  ${BOLD}add${CLEAR}:

  ${BOLD}rm${CLEAR}:

  ${BOLD}clean${CLEAR}:   remove dotfiles and restore to your original settings.

  ${BOLD}help${CLEAR}:    print help (this message).

For more information see: ${BOLD}https://github.com/wasabi315/dotfiles${CLEAR}
               Copyright: ${BOLD}(c) 2018 wasabi315${CLEAR}
                Lincence: ${BOLD}MIT${CLEAR}

HELP

}


deploy() {

  running "Deploying dotfiles"
  ${DOTPATH}/scripts/deploy.sh
  ok "Deploy"

}


init() {

  running "Install softwares..."
  ${DOTPATH}/scripts/init.sh
  ok "Initialize"

}


install() {

  deploy &&
  init

}


update() {

  running "Updating dotfiles..."
  git pull origin master
  ok

}


add() {
  echo "undefined: add"
  echo "$@"
}


rm() {
  echo "undefined: rm"
  echo "$@"
}

clean() {

  echo "todo: restore original config"

  warn "WARNING: This will remove current dotfiles!!"
  warn "Continue?"
  read -r -p "[Y|n]" response
  if [[ $response =~ ^(yes|y|Y) ]]; then
      running "Cleaning dotfiles..."
      bash ${DOTPATH}/scripts/clean.sh
  else
      echo "abort."
      exit 1
  fi


}


command=$1
path=${@:2}

case $command in
  deploy)
    deploy
    ;;
  init)
    init
    ;;
  install)
    install
    ;;
  update)
    update
    ;;
  add)
    add "${path}"
    ;;
  rm)
    rm "${path}"
    ;;
  clean)
    clean
    ;;
  *)
    help
    ;;
esac

exit 0

# vim : filetype=sh
